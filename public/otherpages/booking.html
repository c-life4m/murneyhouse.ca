<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Murney House - Your home away from home">
    <title>Murney House - Booking</title>
    <link rel="icon" type="image/svg+xml" href="../public/images/assets/icons/favicon.svg?v=1">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="../images/assets/FONTS/fontawesome/css/all.min.css">

    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />

    <!-- Main CSS -->
    <link rel="stylesheet" href="../src/styles/style.css">

    <!-- Contact Form Styling -->
    <link rel="stylesheet" href="../shared/contact-modal.css">

    <style>
        #hero.booking-hero {
            position: relative;
            width: 100%;
            height: 50vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .booking-hero-content {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-sizing: border-box;
        }

        .booking-hero-content h1 {
            margin: 0 0 var(--spacing-md);
            animation: flyInFromLeft 1s ease-out forwards;
        }

        .booking-hero-content p {
            margin: 0 auto;
            animation: flyInFromRight 1s ease-out 0.3s both;
        }

        @keyframes flyInFromLeft {
            0% {
                opacity: 0;
                transform: translateX(-300px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes flyInFromRight {
            0% {
                opacity: 0;
                transform: translateX(300px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .rules-card {
            background-color: var(--light-card);
            padding: 3rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            max-width: 800px;
            margin: 3rem auto;
            animation: fadeInUp 1s ease-out both;
        }

        body.dark-mode .rules-card {
            background-color: var(--dark-card);
        }

        .rules-list,
        .requirements-list,
        .disclaimers-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .rules-list li,
        .requirements-list li,
        .disclaimers-list li {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .rules-list li:last-child,
        .requirements-list li:last-child,
        .disclaimers-list li:last-child {
            margin-bottom: 0;
        }

        .rules-list li i,
        .requirements-list li i,
        .disclaimers-list li i {
            flex-shrink: 0;
            font-size: 1.25rem;
            color: var(--cta);
            margin-right: 2ch;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .booking-section {
            padding: 60px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .booking-section h2 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.5rem;
            color: var(--text-primary);
        }

        .rules-list, .requirements-list, .disclaimers-list {
            list-style: none;
            padding: 0;
            max-width: 800px;
            margin: 0 auto;
        }

        .rules-list li, .disclaimers-list li {
            background: var(--card-background);
            margin: 15px 0;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
            box-shadow: var(--shadow-light);
        }

        .requirements-list li {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .requirement-item {
            display: flex;
            align-items: flex-start;
        }

        .cancellation-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .cancellation-info ul {
            padding-left: 20px;
            margin-top: 10px;
            margin-left: 30px;
        }

        .room-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .room-card {
            background: var(--card-background);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow-medium);
            transition: transform 0.3s ease;
            position: relative;
        }

        .room-card:hover {
            transform: translateY(-5px);
        }

        .room-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .room-card-content {
            padding: 20px;
        }

        .room-selection-overlay {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.0);
            padding: 5px;
            border-radius: 5px;
            z-index: 10;
        }

        .room-selection-overlay input[type="checkbox"] {
            margin-right: 8.5px;
            width: 25px;
            height: 25px;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 1.5);
        }

        .room-selection-overlay input[type="number"] {
            width: 50px;
            margin: 0 2.5px;
            -moz-appearance: textfield;
            appearance: textfield;
            color: red !important;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1.5);
        }

        .room-selection-overlay input[type="number"]::-webkit-outer-spin-button,
        .room-selection-overlay input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .room-selection-overlay label {
            margin-right: 1.5px;
            color: red !important;
            font-size: 1.6rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1.5);
        }

        .room-details {
            padding: 10px;
        }

        .room-details h4 {
            margin-top: 10px;
            font-size: 1.4rem;
        }

        .room-details p {
            margin-top: 5px;
            font-size: 1.2rem;
        }

        .room-image {
            position: relative;
            height: 100px;
            overflow: hidden;
        }

        .room-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-medium);
        }

        .room-card:hover .room-image img {
            transform: scale(1.1);
        }

        .calendar-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .calendar-content {
            background: var(--card-background);
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            color: white;
        }

        .calendar-content h2,
        .calendar-content h3,
        .calendar-content h4 {
            color: white !important;
        }

        .fc-bg-event.booked {
            background-color: red !important;
            opacity: 1
        }
        .fc-bg-event.pending {
            background-color: orange !important;
            opacity: 1
        }
        .fc-bg-event.available {
            background-color: green !important;
            opacity: 1
        }

        .fc-daygrid-day-number {
            color: white !important;
            font-weight: 500;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1.5);
        }

        .fc-col-header-cell {
            color: white !important;
        }

        .fc-toolbar-title {
            color: white !important;
        }

        .booking-form {
            display: none;
            background: var(--card-background);
            padding: 40px;
            border-radius: 15px;
            margin-top: 40px;
            box-shadow: var(--shadow-medium);
        }

        .booking-form h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Enhanced text input styling */
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        /* Special styling for text inputs to make them stand out */
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group textarea {
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="email"]:focus,
        .form-group input[type="tel"]:focus,
        .form-group textarea:focus {
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
            border-color: var(--accent-color);
            outline: none;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .room-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .room-option {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .room-option.selected {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .room-option img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .room-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .room-header input[type="checkbox"] {
            margin-right: 5px;
        }

        .room-header input[type="number"] {
            width: 50px;
            margin: 0 5px;
        }

        .price-summary {
            background: var(--accent-light);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        /* Enhanced price summary styling */
        .price-summary-enhanced {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid var(--accent-color);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
        }

        .price-summary-enhanced h3 {
            color: var(--accent-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--accent-color);
        }

        .addon-services {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .addon-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .addon-item:last-child {
            border-bottom: none;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .close-modal:hover {
            color: var(--text-primary);
        }

        /* Enhanced submit button */
        .submit-btn {
            background: var(--cta);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 12px;
            font-size: 1.54rem; /* 40% larger than 1.1rem */
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            cursor: pointer;
            width: auto; /* Changed from 100% to auto to fit text */
            margin: 20px auto 0 auto; /* Center the button */
            display: block; /* Make it a block element so margin auto works */
            box-shadow: 0 8px 20px rgba(255, 87, 34, 0.4);
            transition: all 0.3s ease;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, var(--accent-hover, #e65100), var(--accent-color));
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 87, 34, 0.6);
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 6px 15px rgba(255, 87, 34, 0.4);
        }

        .privacy-notice {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 20px;
            padding: 15px;
            background: var(--card-background);
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
        }

        .popup-content {
            background-color: var(--light-text);
            color: var(--light-background);
            padding: 40px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            max-height: 85vh;
            overflow-y: auto;
            position: relative; /* Add this to ensure proper stacking */
            z-index: 4000;
        }

        .popup-content h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
        }

        .booking-summary-detailed {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }

        .booking-button-container {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .room-selection-container {
            padding: 15px;
            background: var(--dark-background);
            border-radius: 8px;
            border: 1px solid var(--light-border);
            text-align: center;
        }

        .room-selection-container h4 {
            color: white;
            margin-bottom: 15px;
        }

        .room-checkboxes {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .room-checkbox {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            transition: all 0.3s ease;
            color: white;
        }

        .room-checkbox:hover {
            background: var(--cta);
            color: white;
        }

        .room-checkbox input {
            margin-right: 8px;
        }

        .room-checkbox input:checked + span {
            font-weight: 600;
        }

        .multi-room-btn {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            transition: all 0.3s ease;
            color: white;
            background: transparent;
            font-size: 1rem;
            margin-left: 0;
            margin-right: 0;
            margin-top: 0;
            margin-bottom: 0;
        }

        .multi-room-btn:hover,
        .multi-room-btn.active {
            background: var(--cta);
            color: white;
            font-weight: 600;
        }

        .multi-room-btn.active {
            background: orange;
            color: white;
            font-weight: 600;
        }

        /* Return to home button styling */
        .return-home-btn {
            background: var(--secondary-color, #4CAF50);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .return-home-btn:hover {
            background: var(--secondary-hover, #45a049);
            transform: translateY(-1px);
        }

        /* Promo code input styling */
        .promo-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 15px 0;
        }

        .promo-input input {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.06);
        }

        .promo-apply-btn {
            background: var(--accent-color);
            color: grey;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .promo-apply-btn:hover {
            background: var(--accent-hover);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .room-selection {
                grid-template-columns: 1fr;
            }

            .booking-section {
                padding: 40px 15px;
            }

            .popup-content {
                width: 95%;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header with navigation -->
    <header>
        <div class="logo">
            <a href="../index.html">Murney House</a>
        </div>
        <nav>
            <div class="desktop-nav">
                <ul>
                    <li><a href="rooms.html">Rooms</a></li>
                    <li><a href="amenities.html">Amenities</a></li>
                    <li><a href="../index.html#local-area">Local Area</a></li>
                    <li><a href="guest-hub.html">Guest Hub</a></li>
                    <li><a href="?contact=1">Contact</a></li>
                </ul>
            </div>
            <div class="mobile-nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="mobile-nav">
                <ul>
                    <li><a href="../index.html">Back to Home</a></li>
                    <li class="nav-item"><a href="rooms.html">Rooms</a></li>
                    <li class="nav-item"><a href="amenities.html">Amenities</a></li>
                    <li class="nav-item"><a href="../index.html#local-area" class="nav-link">Local Area</a></li>
                    <li class="nav-item"><a href="guest-hub.html" class="nav-link">Guest Hub</a></li>
                    <li class="nav-item"><a href="?contact=1" class="nav-link">Contact</a></li>
                </ul>
            </div>
        </nav>
        <div class="header-controls">
            <button class="theme-toggle" aria-label="Toggle dark mode">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
                    <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2"/>
                    <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2"/>
                    <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2"/>
                    <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2"/>
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2"/>
                </svg>
            </button>
        </div>
    </header>

    <!-- Booking Hero Section -->
    <section id="hero" class="booking-hero">
        <div class="booking-hero-background hero-image"></div>
        <div class="booking-hero-content">
            <h1>Booking Page</h1>
            <p>Please review the house rules, booking requirements, disclaimers & warnings before continuing on to booking.</p>
        </div>
    </section>

    <!-- House Rules Section -->
    <section class="booking-section rules-card">
        <h2>House Rules</h2>
        <ul class="rules-list">
            <li><i class="fas fa-smoking-ban"></i> No smoking/vaping on the property.</li>
            <li><i class="fas fa-volume-down"></i> No loud noises after 10pm.</li>
            <li><i class="fas fa-clock"></i> Check-in after 3pm / checkout before 12pm (noon).</li>
            <li><i class="fas fa-shoe-prints"></i> Take shoes off at the door.</li>
            <li><i class="fas fa-wifi"></i> You agree not to use our internet for anything illegal.</li>
            <li><i class="fas fa-music"></i> Bedroom 3 ("Party Room") is the only room for louder music, partying, dancing, etc. The rest of the house is for quieter enjoyment.</li>
            <li><i class="fas fa-question-circle"></i> Special needs/requests? Check with us in advance.</li>
            <li><i class="fas fa-book"></i> Familiarize yourself with all appliances/gadgets (see Guest Hub page for instructions) before use — it's your responsibility.</li>
        </ul>
    </section>

    <!-- Booking Requirements Section -->
    <section class="booking-section rules-card">
        <h2>Booking Requirements</h2>
        <ul class="requirements-list">
            <li>
                <div class="requirement-item">
                    <i class="fas fa-credit-card"></i> Primary renter must have a current credit score of 800+, or provide a recent credit card bill showing a $30,000+ credit limit, or (if neither is available) a refundable security deposit of at least $1,000 (amount may increase with the number of guests/days).
                </div>
            </li>
            <li>
                <div class="requirement-item">
                    <i class="fas fa-money-check"></i> 50% of rental fee required to confirm booking (Interac transfer only at this time).
                </div>
            </li>
            <li>
                <div class="requirement-item">
                    <i class="fas fa-undo"></i> <strong>Cancellations & Refunds:</strong>
                </div>
                <div class="cancellation-info">
                    <ul style="padding-left: 20px;">
                        <li>100% if cancelled ≥24hrs before check-in (3pm)</li>
                        <li>50% if cancelled ≥12hrs before</li>
                        <li>25% if cancelled ≥6hrs before</li>
                        <li>No refund <6hrs or for no-shows</li>
                    </ul>
                </div>
            </li>
        </ul>
    </section>

    <!-- Disclaimers & Warnings Section -->
    <section class="booking-section rules-card">
        <h2>Disclaimers & Warnings</h2>
        <ul class="disclaimers-list">
            <li><i class="fas fa-exclamation-triangle"></i> Use of gadgets, appliances, cookware, and utensils is at your own risk.</li>
            <li><i class="fas fa-exclamation-triangle"></i> Some common area floors are polished porcelain tile - can be slippery when wet or if wearing socks.</li>
            <div class="room-card">
                <img src="../images/assets/PX/slick floor-1200.webp" alt="Slick Floor" onerror="this.src='../public/images/assets/PX/placeholder.jpg'">
                <div class="room-card-content">
                <p>Please be aware of the fact that the floors in the kitchen area, bathrooms and foyer due to their polished surface may pose a risk of slipping and falling and you are accepting this risk.</p>
        </ul>
    </section>

    <!-- Request Booking Section -->
    <section class="booking-section">
        <h2>Request Booking</h2>
        <div class="room-cards">
            <div class="room-card">
                <img src="../images/assets/PX/Brm-1A-800.webp" alt="Room 1" onerror="this.src='../images/assets/PX/placeholder.jpg'">
                <div class="room-card-content">
                    <h3>Room 1</h3>
                    <p>Double bed. 1-2 Guests, large window, morning sun and view of front yard.</p>
                    <button class="cta-button" onclick="openCalendar('Room 1')">Select Your Days</button>
                </div>
            </div>
            <div class="room-card">
                <img src="../images/assets/PX/Brm-2A-800.webp" alt="Room 2" onerror="this.src='../images/assets/PX/placeholder.jpg'">
                <div class="room-card-content">
                    <h3>Room 2</h3>
                    <p>2 stacked twin beds. 1-2 Guests. Large window overlooking a green side yard.</p>
                    <button class="cta-button" onclick="openCalendar('Room 2')">Select Your Days</button>
                </div>
            </div>
            <div class="room-card">
                <img src="../images/assets/PX/Brm-3A-800.webp" alt="Room 3 - Party Room" onerror="this.src='../images/assets/PX/placeholder.jpg'">
                <div class="room-card-content">
                    <h3>Room 3 - Party</h3>
                    <p>Sleeps up to 4, can also be used for louder music, parties and gatherings.</p>
                    <button class="cta-button" onclick="openCalendar('Room 3')">Select Your Days</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Calendar Modal -->
    <div id="calendarModal" class="calendar-modal">
        <div class="calendar-content">
            <span class="close-modal" onclick="closeCalendar()">&times;</span>
            <h3 id="calendarTitle">Select Your Days</h3>
            <div id="calendar"></div>
            <div style="margin-top: 20px;">
                <p><span style="color: green;">■</span> Available <span style="color: orange;">■</span> Pending <span style="color: red;">■</span> Booked / Unavailable</p>
                <div class="booking-button-container">
                    <button id="proceedToBooking" type="button" onclick="proceedToBooking()" style="display: none;" class="cta-button large">Proceed to Booking Form</button>
                </div>
            </div>

            <!-- Room Selection -->
            <div class="room-selection-container" style="margin-bottom: 20px;">
                <h4>Select Your Room Choices:</h4>
                <div class="room-checkboxes">
                    <label class="room-checkbox">
                        <input type="checkbox" class="room-select" value="Room 1">
                        <span>Room 1</span>
                    </label>
                    <label class="room-checkbox">
                        <input type="checkbox" class="room-select" value="Room 2">
                        <span>Room 2</span>
                    </label>
                    <label class="room-checkbox">
                        <input type="checkbox" class="room-select" value="Room 3">
                        <span>Room 3</span>
                    </label>
                    <!-- Multi-room buttons -->
                    <button type="button" class="multi-room-btn" data-rooms="Room 1,Room 2">Rooms 1+2</button>
                    <button type="button" class="multi-room-btn" data-rooms="Room 1,Room 2,Room 3">Rooms 1+2+3</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Request Form -->
    <div id="bookingForm" class="booking-form">
        <h2>Booking Request Form</h2>
        <form id="bookingRequestForm">
            <!-- Primary Guest Section -->
            <div style="border: 2px solid var(--accent-color); border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: var(--accent-color); margin-bottom: 15px;">Primary Guest Information</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">Primary Guest - First Name *</label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Primary Guest - Last Name *</label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="primaryGuestAge">Primary Guest - Age *</label>
                        <input type="number" id="primaryGuestAge" name="primaryGuestAge" min="18" max="120" required>
                    </div>
                    <div class="form-group">
                        <label for="totalGuests">Total Guests (Auto-Updated) *</label>
                        <input type="number" id="totalGuests" name="totalGuests" min="1" max="9" value="1" readonly style="background-color: rgba(100, 100, 100, 0.3);">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone *</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="creditScore">Current Credit Score (Optional)</label>
                    <input type="number" id="creditScore" name="creditScore" min="300" max="950">
                </div>
            </div>

            <div class="form-group">
                <label for="guestCount">Number of Additional Guests (up to 8 additional) *</label>
                <select id="guestCount" name="guestCount" required onchange="updateGuestDetails()">
                    <option value="0">No additional guests</option>
                    <option value="1">1 Additional Guest</option>
                    <option value="2">2 Additional Guests</option>
                    <option value="3">3 Additional Guests</option>
                    <option value="4">4 Additional Guests</option>
                    <option value="5">5 Additional Guests</option>
                    <option value="6">6 Additional Guests</option>
                    <option value="7">7 Additional Guests</option>
                    <option value="8">8 Additional Guests</option>
                </select>
            </div>

            <div id="guestDetails"></div>

            <div class="form-group">
                <label>Room Selection *</label>
                <div class="room-selection">
                    <div class="room-option">
                        <div class="room-image">
                            <img src="../images/assets/PX/Brm-1A-800.webp" alt="Room 1" onerror="this.src='../images/assets/PX/Brm-1A-800.webp'">
                            <div class="room-selection-overlay">
                                <input type="checkbox" id="room1" name="rooms" value="room1" onchange="updatePriceSummary()">
                                <label for="room1">x</label>
                                <input type="number" id="room1Days" name="room1Days" min="1" max="99" value="1" onchange="updatePriceSummary(); validateDaysAgainstAvailability(this);" oninput="limitDaysInput(this)">
                                <label for="room1Days">days</label>
                                <input type="hidden" id="room1StartDate" name="room1StartDate" value="">
                            </div>
                        </div>
                        <div class="room-details">
                            <h4>Room 1</h4>
                            <p>$129/night</p>
                        </div>
                    </div>
                    <div class="room-option">
                        <div class="room-image">
                            <img src="../images/assets/PX/Brm-2A-800.webp" alt="Room 2" onerror="this.src='..images/assets/PX/Brm-2A-800.webp'">
                            <div class="room-selection-overlay">
                                <input type="checkbox" id="room2" name="rooms" value="room2" onchange="updatePriceSummary()">
                                <label for="room2">x</label>
                                <input type="number" id="room2Days" name="room2Days" min="1" max="99" value="1" onchange="updatePriceSummary(); validateDaysAgainstAvailability(this);" oninput="limitDaysInput(this)">
                                <label for="room2Days">days</label>
                                <input type="hidden" id="room2StartDate" name="room2StartDate" value="">
                            </div>
                        </div>
                        <div class="room-details">
                            <h4>Room 2</h4>
                            <p>$99/night</p>
                        </div>
                    </div>
                    <div class="room-option">
                        <div class="room-image">
                            <img src="../images/assets/PX/Brm-3A-800.webp" alt="Room 3" onerror="this.src='../images/assets/PX/Brm-3A-800.webp'">
                            <div class="room-selection-overlay">
                                <input type="checkbox" id="room3" name="rooms" value="room3" onchange="updatePriceSummary()">
                                <label for="room3">x</label>
                                <input type="number" id="room3Days" name="room3Days" min="1" max="99" value="1" onchange="updatePriceSummary(); validateDaysAgainstAvailability(this);" oninput="limitDaysInput(this)">
                                <label for="room3Days">days</label>
                                <input type="hidden" id="room3StartDate" name="room3StartDate" value="">
                            </div>
                        </div>
                        <div class="room-details">
                            <h4>Room 3</h4>
                            <p>$169/night</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Price Summary Section -->
            <div class="price-summary-enhanced">
                <h3>Price Summary</h3>
                <div id="priceSummary">
                    <p>Select rooms and dates to see pricing</p>
                </div>

                <!-- Discounts & Promotions -->
                <div class="promo-input">
                    <input type="text" id="promoCode" name="promoCode" placeholder="Enter promo code">
                    <button type="button" class="promo-apply-btn" onclick="applyPromoCode()">Apply</button>
                </div>
                <div id="promoMessage" style="color: var(--accent-color); font-size: 0.9rem; margin-top: 5px;"></div>
            </div>

            <div class="addon-services">
                <h3>Add-on Services</h3>
                <div class="addon-item">
                    <div>
                        <strong>Pick Up At Via Rail Station</strong>
                        <p>$20 for up to 4 guests</p>
                    </div>
                    <input type="checkbox" id="pickup" name="pickup" value="20" onchange="updatePriceSummary()">
                </div>
            </div>

            <div class="form-group">
                <label for="specialRequests">Special Requests (500 character limit)</label>
                <textarea id="specialRequests" name="specialRequests" maxlength="500" rows="4" placeholder="Any special requests or requirements..."></textarea>
                <small id="charCount">0/500 characters</small>
            </div>

            <button type="submit" class="submit-btn">Submit Booking Request</button>

            <div class="privacy-notice">
                <strong>Privacy Notice:</strong> Personal information collected is used exclusively for renting our rooms and resolving disputes, not shared except as required by law. All info is encrypted and transmitted via secure HTTPS.
            </div>
        </form>
    </div>

    <!-- Thank You Popup -->
    <div id="thankYouPopup" class="popup-overlay">
        <div class="popup-content">
            <h2>Request Received!</h2>
            <p>Thank you for your booking request.</p>

            <div class="booking-summary-detailed">
                <p><strong>Booking Request ID: <span id="uniqueId" style="color: var(--accent-color); font-size: 1.3rem;"></span></strong></p>
                <div id="bookingSummary"></div>
                <div id="fullPriceBreakdown"></div>
            </div>

            <p style="margin: 20px 0; padding: 15px; background: rgba(255, 255, 200, 0.1); border-radius: 8px; border-left: 4px solid var(--accent-color);">
                <strong>Important:</strong> A  request confirmation notice has been sent to your email address. If you don't hear from us within 24 hours, please follow up with booking@murneyhouse.ca with your <strong>Booking Request ID</strong> in the subject line. Take a screenshot of this Summary for your records.
            </p>

            <button onclick="returnToHome()" class="return-home-btn">Return to Home</button>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h3>Contact</h3>
                    <address>
                        <p>123 Main Street<br>Belleville, ON, Canada K8P 3N6</p>
                        <p><a href="tel:+15551234567">(555) 123-4567</a></p>
                        <p><a href="mailto:info@murneyhouse.ca">info@murneyhouse.ca</a></p>
                    </address>
                </div>

                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="guest-hub.html">Guest Hub</a></li>
                        <li><a href="amenities.html">Amenities</a></li>
                        <li><a href="rooms.html">Rooms</a></li>
                        <li><a href="booking.html">Policies</a></li>
                        <li><a href="contact.html">FAQs</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Murney House. All rights reserved.</p>
                <div class="footer-links">
                    <a href="booking.html">Privacy Policy</a>
                    <a href="booking.html">Terms of Service</a>
                    <a href="contact.html">Sitemap</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script src="../src/script.js"></script>
    <script src="../shared/contact-modal.js"></script>
    <script>
    // Booking page specific JavaScript
    let calendar;
    let selectedDates = [];
    let currentRoom = '';
    let addons = { eggs: 0, tomatoes: 0 };
    let activePromoDiscount = 0; // e.g. 0.10 for 10%

    // Room availability data
    const roomAvailability = {
        "Room 1": {
            booked: ["2025-06-30", "2025-07-01"],
            pending: ["2025-07-03", "2025-07-04"]
        },
        "Room 2": {
            booked: ["2025-07-03"],
            pending: ["2025-07-06"]
        },
        "Room 3": {
            booked: ["2025-07-03"],
            pending: ["2025-07-04"]
        }
    };

    // Set responsive background image for booking hero
    function setBookingHeroBackground() {
        const heroBackground = document.querySelector('.booking-hero-background');
        const width = window.innerWidth;

        let imagePath;
        if (width >= 1200) {
            imagePath = '../images/assets/PX/hero-1920.webp';
        } else if (width >= 768) {
            imagePath = '../images/assets/PX/hero-1200.webp';
        } else {
            imagePath = '../images/assets/PX/hero-800.webp';
        }

        heroBackground.style.backgroundImage = `url('${imagePath}')`;
    }

    // Update calendar availability
    function updateCalendarAvailability(selectedRooms) {
        if (calendar) {
            calendar.getEvents().forEach(event => event.remove());
        }

        if (!selectedRooms.length) return;

        const bookedDates = new Set();
        const pendingDates = new Set();

        selectedRooms.forEach(room => {
            const roomData = roomAvailability[room] || {};
            (roomData.booked || []).forEach(date => bookedDates.add(date));
            (roomData.pending || []).forEach(date => pendingDates.add(date));
        });

        const view = calendar.view;
        const start = new Date(view.currentStart);
        const end = new Date(view.currentEnd);
        for (let d = new Date(start); d < end; d.setDate(d.getDate() + 1)) {
            const dateStr = d.toISOString().split('T')[0];
            if (bookedDates.has(dateStr)) {
                calendar.addEvent({
                    start: dateStr,
                    display: 'background',
                    classNames: ['booked']
                });
            } else if (pendingDates.has(dateStr)) {
                calendar.addEvent({
                    start: dateStr,
                    display: 'background',
                    classNames: ['pending']
                });
            } else {
                calendar.addEvent({
                    start: dateStr,
                    display: 'background',
                    classNames: ['available']
                });
            }
        }
    }

    // Enhanced date formatting function for (PM) and (AM) format
    function formatDateWithTime(date, isPM = true) {
        const months = ['January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'];
        const monthsShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                            'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

        const day = date.getDate();
        const month = monthsShort[date.getMonth()];
        const year = date.getFullYear();
        const timeIndicator = isPM ? '(PM)' : '(AM)';

        return `${timeIndicator} ${day} ${month} ${year}`;
    }

    function formatDateLongWithTime(date, isPM = true) {
        const months = ['January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'];

        const day = date.getDate();
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        const timeIndicator = isPM ? '(PM)' : '(AM)';

        return `${timeIndicator} ${day} ${month} ${year}`;
    }

    // Calendar functions
    function openCalendar(roomId) {
        currentRoom = roomId;
        document.querySelectorAll('.room-checkboxes input[type="checkbox"]').forEach(cb => {
            cb.checked = false;
        });

        const targetCheckbox = document.querySelector(`.room-checkboxes input[type="checkbox"][value="${roomId}"]`);
        if (targetCheckbox) {
            targetCheckbox.checked = true;
        }

        document.getElementById('calendarModal').style.display = 'flex';
        document.getElementById('calendarTitle').textContent = formatRoomTitle(roomId);

        if (!calendar) {
            initializeCalendar();
        }
    }

    function formatRoomTitle(roomId) {
        if (roomId.includes(',')) {
            const numbers = roomId.split(',').map(id => id.match(/\d+/)?.[0]).filter(Boolean);
            return `Room${numbers.length > 1 ? 's' : ''} ${numbers.join(' & ')} - Select Your Days`;
        } else {
            return `Select Your Days`;
        }
    }

    // Handle checkbox changes with synchronization
    document.querySelectorAll('.room-select').forEach(cb => {
        cb.addEventListener('change', function() {
            const selectedRooms = [];
            document.querySelectorAll('.room-select:checked').forEach(cb => {
                selectedRooms.push(cb.value);
            });
            updateCalendarAvailability(selectedRooms);
            synchronizeRoomDays();
        });
    });

    // Room synchronization function - UPDATED
    function synchronizeRoomDays() {
        const checkedRooms = Array.from(document.querySelectorAll('#bookingForm input[type="checkbox"][name="rooms"]:checked'));

        if (checkedRooms.length > 0) {
            // Get the highest number of days from checked rooms
            let maxDays = 1;
            checkedRooms.forEach(room => {
                const roomId = room.id;
                const daysInput = document.getElementById(`${roomId}Days`);
                if (daysInput) {
                    maxDays = Math.max(maxDays, parseInt(daysInput.value) || 1);
                }
            });

            // Set all checked rooms to the same number of days
            checkedRooms.forEach(room => {
                const roomId = room.id;
                const daysInput = document.getElementById(`${roomId}Days`);
                if (daysInput) {
                    daysInput.value = maxDays;
                }
            });

            // UPDATE SESSION STORAGE DATES TO REFLECT NEW DAY COUNT
            const selectedDates = JSON.parse(sessionStorage.getItem('selectedDates') || '{}');
            if (selectedDates.start && maxDays > 1) {
                const startDate = new Date(selectedDates.start);
                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + maxDays - 1);

                sessionStorage.setItem('selectedDates', JSON.stringify({
                    start: selectedDates.start,
                    end: endDate.toISOString().split('T')[0]
                }));
            } else if (selectedDates.start && maxDays === 1) {
                // Single day selection
                sessionStorage.setItem('selectedDates', JSON.stringify({
                    start: selectedDates.start,
                    end: selectedDates.start
                }));
            }
        }

        // Reset unchecked rooms to 1 day
        document.querySelectorAll('#bookingForm input[type="checkbox"][name="rooms"]:not(:checked)').forEach(room => {
            const roomId = room.id;
            const daysInput = document.getElementById(`${roomId}Days`);
            if (daysInput) {
                daysInput.value = 1;
            }
        });

        updatePriceSummary();
    }

    // Handle multi-room button clicks
    document.querySelectorAll('.multi-room-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const rooms = btn.getAttribute('data-rooms').split(',');
            document.querySelectorAll('.room-select').forEach(cb => {
                cb.checked = rooms.includes(cb.value);
            });
            updateCalendarAvailability(rooms);
            synchronizeRoomDays();
        });
    });

    function closeCalendar() {
        document.getElementById('calendarModal').style.display = 'none';
    }

    let firstSelectedDate = null;

    function initializeCalendar() {
        const calendarEl = document.getElementById('calendar');
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            selectable: true,
            validRange: {
                start: new Date()
            },
            events: [
                { title: 'Booked', start: '2025-07-15', color: 'red' },
                { title: 'Pending', start: '2025-07-20', color: 'orange' }
            ],
            dateClick: function(info) {
                const selectedRooms = Array.from(document.querySelectorAll('.room-select:checked')).map(cb => cb.value);
                const selectedDate = info.dateStr;

                let isBlocked = false;
                selectedRooms.forEach(room => {
                    if (
                        (roomAvailability[room]?.booked || []).includes(selectedDate) ||
                        (roomAvailability[room]?.pending || []).includes(selectedDate)
                    ) {
                        isBlocked = true;
                    }
                });

                if (isBlocked) {
                    alert("This date is already booked or pending for the selected room(s). Please choose another date.");
                    return;
                }

                if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                    const clickedDate = info.dateStr;

                    calendar.getEvents().forEach(event => {
                        if (event.title === 'Selected') {
                            event.remove();
                        }
                    });

                    if (!firstSelectedDate) {
                        firstSelectedDate = clickedDate;
                        calendar.addEvent({
                            title: 'Selected',
                            start: clickedDate,
                            end: clickedDate,
                            color: 'orange'
                        });
                    } else {
                        const date1 = firstSelectedDate;
                        const date2 = clickedDate;
                        const rangeStart = date1 <= date2 ? date1 : date2;
                        const rangeEnd = date1 <= date2 ? date2 : date1;

                        let isBlocked = false;
                        let current = new Date(rangeStart);
                        const end = new Date(rangeEnd);
                        const selectedRooms = Array.from(document.querySelectorAll('.room-select:checked')).map(cb => cb.value);
                        while (current <= end) {
                            const dateStr = current.toISOString().split('T')[0];
                            selectedRooms.forEach(room => {
                                if (
                                    (roomAvailability[room]?.booked || []).includes(dateStr) ||
                                    (roomAvailability[room]?.pending || []).includes(dateStr)
                                ) {
                                    isBlocked = true;
                                }
                            });
                            current.setDate(current.getDate() + 1);
                        }
                        if (isBlocked) {
                            alert("One or more selected dates are already booked or pending for the selected room(s). Please choose another range.");
                            firstSelectedDate = null;
                            return;
                        }

                        const nextDay = new Date(rangeEnd);
                        nextDay.setDate(nextDay.getDate() + 1);
                        const rangeEndForCalendar = nextDay.toISOString().split('T')[0];

                        calendar.addEvent({
                            title: 'Selected',
                            start: rangeStart,
                            end: rangeEndForCalendar,
                            color: 'orange'
                        });

                        firstSelectedDate = null;
                    }

                    document.getElementById('proceedToBooking').style.display = 'inline-block';
                }
            },
            datesSet: function(info) {
                const selectedRooms = Array.from(document.querySelectorAll('.room-select:checked')).map(cb => cb.value);
                updateCalendarAvailability(selectedRooms);
            },
            select: function(info) {
                const selectedRooms = Array.from(document.querySelectorAll('.room-select:checked')).map(cb => cb.value);
                const startDate = info.startStr;

                calendar.getEvents().forEach(event => {
                    if (event.title === 'Selected') {
                        event.remove();
                    }
                });

                if (!firstSelectedDate) {
                    firstSelectedDate = startDate;
                    calendar.addEvent({
                        title: 'Selected',
                        start: startDate,
                        end: startDate,
                        color: 'orange'
                    });
                } else {
                    const date1 = firstSelectedDate;
                    const date2 = startDate;
                    const rangeStart = date1 <= date2 ? date1 : date2;
                    const rangeEnd = date1 <= date2 ? date2 : date1;

                    let isBlocked = false;
                    let current = new Date(rangeStart);
                    const end = new Date(rangeEnd);
                    while (current <= end) {
                        const dateStr = current.toISOString().split('T')[0];
                        selectedRooms.forEach(room => {
                            if (
                                (roomAvailability[room]?.booked || []).includes(dateStr) ||
                                (roomAvailability[room]?.pending || []).includes(dateStr)
                            ) {
                                isBlocked = true;
                            }
                        });
                        current.setDate(current.getDate() + 1);
                    }

                    if (isBlocked) {
                        alert("One or more selected dates are already booked or pending for the selected room(s). Please choose another range.");
                        firstSelectedDate = null;
                        return;
                    }

                    const nextDay = new Date(rangeEnd);
                    nextDay.setDate(nextDay.getDate() + 1);
                    const rangeEndForCalendar = nextDay.toISOString().split('T')[0];

                    calendar.addEvent({
                        title: 'Selected',
                        start: rangeStart,
                        end: rangeEndForCalendar,
                        color: 'orange'
                    });

                    firstSelectedDate = null;
                }

                document.getElementById('proceedToBooking').style.display = 'inline-block';
            },
            eventClick: function(info) {
                const clickedDate = info.event.start;

                const eventsToRemove = calendar.getEvents().filter(event => {
                    return event.start >= clickedDate && event.title === 'Selected';
                });

                if (eventsToRemove.length > 0) {
                    eventsToRemove.forEach(event => event.remove());
                } else {
                    calendar.addEvent({
                        title: 'Selected',
                        start: clickedDate,
                        end: clickedDate,
                        color: 'orange'
                    });
                }
            }
        });
        calendar.render();

        const selectedRooms = Array.from(document.querySelectorAll('.room-select:checked')).map(cb => cb.value);
        updateCalendarAvailability(selectedRooms);
    }

    function proceedToBooking() {
        const selectedRooms = Array.from(document.querySelectorAll('.room-checkbox input:checked'))
            .map(checkbox => checkbox.value);

        const selectedEvents = calendar.getEvents().filter(event => event.title === 'Selected');

        if (selectedEvents.length > 0 && selectedRooms.length > 0) {
            sessionStorage.setItem('selectedRooms', JSON.stringify(selectedRooms));

            if (selectedEvents.length > 0) {
                const startDate = selectedEvents[0].startStr;
                let endDate = selectedEvents[0].end;

                // Fix for single day selection - if no end date or same as start
                if (!endDate || selectedEvents[0].startStr === selectedEvents[0].endStr) {
                    // Single day selection - end date is same as start date
                    sessionStorage.setItem('selectedDates', JSON.stringify({
                        start: startDate,
                        end: startDate
                    }));
                } else {
                    // Multi-day selection
                    endDate = new Date(endDate);
                    endDate.setDate(endDate.getDate() - 1);
                    const endDateStr = endDate.toISOString().split('T')[0];
                    sessionStorage.setItem('selectedDates', JSON.stringify({
                        start: startDate,
                        end: endDateStr
                    }));
                }
            }

            const calendarModal = document.getElementById('calendarModal');
            if (calendarModal) {
                calendarModal.style.display = 'none';
            }

            const bookingForm = document.getElementById('bookingForm');
            if (bookingForm) {
                bookingForm.parentNode.removeChild(bookingForm);
                document.body.appendChild(bookingForm);

                const allRoomCheckboxes = document.querySelectorAll('#bookingForm input[type="checkbox"][name="rooms"]');
                allRoomCheckboxes.forEach(cb => {
                    cb.checked = false;
                });

                const allDaysInputs = document.querySelectorAll('#bookingForm input[type="number"][id$="Days"]');
                allDaysInputs.forEach(input => {
                    input.value = 1;
                });

                const selectedRoomsRaw = JSON.parse(sessionStorage.getItem('selectedRooms') || '[]');
                const selectedDates = JSON.parse(sessionStorage.getItem('selectedDates') || '{}');

                const selectedRooms = selectedRoomsRaw.map(r => r.replace(/\s+/g, '').toLowerCase());

                selectedRooms.forEach(roomId => {
                    const checkbox = document.querySelector(`#bookingForm input[type="checkbox"][id="${roomId}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });

                let numDays = 1;
                if (selectedDates.start && selectedDates.end) {
                    const start = new Date(selectedDates.start);
                    const end = new Date(selectedDates.end);
                    numDays = Math.max(1, Math.round((end - start) / (1000 * 60 * 60 * 24)) + 1);
                }

                selectedRooms.forEach(roomId => {
                    const daysInput = document.querySelector(`#bookingForm input[name="${roomId}Days"]`);
                    if (daysInput) {
                        daysInput.value = numDays;
                    }
                    const startDateInput = document.getElementById(`${roomId}StartDate`);
                    if (startDateInput && selectedDates.start) {
                        startDateInput.value = selectedDates.start;
                    }
                });

                updatePriceSummary();
                bookingForm.style.display = 'block';
                bookingForm.scrollIntoView({ behavior: 'smooth' });
            }
        } else {
            alert('Please select at least one room and date range.');
        }
    }

    // Multi-room selection logic
    document.querySelectorAll('.multi-room-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            if (this.classList.contains('active')) {
                this.classList.remove('active');
                document.querySelectorAll('.room-checkboxes input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.disabled = false;
                });
                return;
            }

            const rooms = this.getAttribute('data-rooms').split(',');

            rooms.forEach(roomName => {
                const cb = Array.from(document.querySelectorAll('.room-checkboxes input[type="checkbox"]'))
                    .find(cb => cb.value.trim() === roomName.trim());
                if (cb) {
                    cb.checked = true;
                    cb.disabled = true;
                }
            });

            document.querySelectorAll('.multi-room-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });

    document.querySelectorAll('.room-checkboxes input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', function() {
            document.querySelectorAll('.multi-room-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.room-checkboxes input[type="checkbox"]').forEach(cb2 => cb2.disabled = false);
        });
    });

    // Form functions
    function updateGuestDetails() {
        const guestCount = parseInt(document.getElementById('guestCount').value) || 0;
        const guestDetailsDiv = document.getElementById('guestDetails');

        // Update total guests count (primary guest + additional guests)
        document.getElementById('totalGuests').value = guestCount + 1;

        if (guestCount > 0) {
            let html = '<div style="border: 2px dashed var(--accent-color); border-radius: 8px; padding: 20px; margin-bottom: 25px;"><h3 style="color: var(--accent-color); margin-bottom: 15px;">Additional Guest Information</h3>';
            for (let i = 1; i <= guestCount; i++) {
                html += `
                    <div class="form-row">
                        <div class="form-group">
                            <label for="guest${i}Name">Additional Guest ${i} - Name *</label>
                            <input type="text" id="guest${i}Name" name="guest${i}Name" required>
                        </div>
                        <div class="form-group">
                            <label for="guest${i}Age">Additional Guest ${i} - Age *</label>
                            <input type="number" id="guest${i}Age" name="guest${i}Age" min="1" max="120" required>
                        </div>
                    </div>
                `;
            }
            html += '</div>';
            guestDetailsDiv.innerHTML = html;
        } else {
            guestDetailsDiv.innerHTML = '';
        }

        // Update price summary to reflect guest surcharge
        updatePriceSummary();
    }

    // Validation function for days against availability
    function validateDaysAgainstAvailability(input) {
        const roomId = input.id.replace('Days', '');
        const startDateStr = document.getElementById(`${roomId}StartDate`).value;
        const numDays = parseInt(input.value, 10);

        if (!startDateStr || isNaN(numDays)) return;

        const startDate = new Date(startDateStr);
        const roomName = roomId.charAt(0).toUpperCase() + roomId.slice(1).replace(/(\d)/g, ' $1');
        const unavailableDates = getUnavailableDates(roomName);

        let conflict = false;
        for (let i = 0; i < numDays; i++) {
            const checkDate = new Date(startDate);
            checkDate.setDate(startDate.getDate() + i);
            const checkDateStr = checkDate.toISOString().split('T')[0];
            if (unavailableDates.includes(checkDateStr)) {
                conflict = true;
                break;
            }
        }

        if (conflict) {
            alert('Selected days include unavailable (booked or pending) dates. Please choose a different range.');
            input.value = 1;
            updatePriceSummary();
        }
    }

    function getUnavailableDates(roomName) {
        const room = roomAvailability[roomName];
        if (!room) return [];
        return [...(room.booked || []), ...(room.pending || [])];
    }

    function limitDaysInput(input) {
        input.value = input.value.replace(/\D/g, '');
        if (input.value.length > 2) {
            input.value = input.value.slice(0, 2);
        }
        if (input.value !== '') {
            let val = Math.abs(parseInt(input.value, 10));
            if (isNaN(val) || val < 1) val = 1;
            if (val > 99) val = 99;
            input.value = val;
        }
    }

    // Calculate multi-room discount
    function calculateMultiRoomDiscount(selectedRoomsCount, subtotal) {
        if (selectedRoomsCount === 2) {
            return subtotal * 0.10; // 10% discount
        } else if (selectedRoomsCount === 3) {
            return subtotal * 0.20; // 20% discount
        }
        return 0;
    }

    // Enhanced price summary with all new features
    function updatePriceSummary() {
        const summary = document.getElementById('priceSummary');
        const roomPrices = {
            room1: 129,
            room2: 99,
            room3: 169
        };

        let roomTotal = 0;
        let selectedRoomsDisplay = '';
        let dateInfo = '';
        let numDaysTotal = 0;

        // Calculate room totals and build display
        const selectedRooms = document.querySelectorAll('#bookingForm input[type="checkbox"][name="rooms"]:checked');
        const roomSelections = [];

        selectedRooms.forEach(room => {
            const roomId = room.id;
            const days = parseInt(document.getElementById(`${roomId}Days`).value) || 1;
            const roomCost = roomPrices[roomId] * days;
            roomTotal += roomCost;
            numDaysTotal = Math.max(numDaysTotal, days);

            const roomNum = roomId.replace('room', '');
            roomSelections.push(roomNum);
        });

        // Room selection display
        if (roomSelections.length > 0) {
            selectedRoomsDisplay = roomSelections.length === 1 ?
                `Room ${roomSelections[0]}` :
                `Rooms ${roomSelections.join('+')}`;
        }

        // Enhanced date information with (PM) and (AM) format
        const selectedDates = JSON.parse(sessionStorage.getItem('selectedDates') || '{}');
        if (selectedDates.start && selectedDates.end) {
            let startDate, endDate;

            try {
                startDate = new Date(selectedDates.start);
                endDate = new Date(selectedDates.end);

                // Validate dates
                if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                    console.error('Invalid dates:', selectedDates);
                    return;
                }

                // Handle single day vs multi-day selection
                if (selectedDates.start === selectedDates.end) {
                    // Single day selection: PM start, AM next day end
                    const nextDay = new Date(startDate);
                    nextDay.setDate(nextDay.getDate() + 1);

                    dateInfo = `
                        <div class="summary-item">
                            <span>Start Date:</span>
                            <span>${formatDateWithTime(startDate, true)}</span>
                        </div>
                        <div class="summary-item">
                            <span>End Date:</span>
                            <span>${formatDateWithTime(nextDay, false)}</span>
                        </div>
                        <div class="summary-item">
                            <span>Number of Days:</span>
                            <span>1</span>
                        </div>
                    `;
                } else {
                    // Multi-day selection: PM start, AM day after end
                    const nextDay = new Date(endDate);
                    nextDay.setDate(nextDay.getDate() + 1);

                    const timeDiff = endDate.getTime() - startDate.getTime();
                    const dayCount = Math.max(1, Math.floor(timeDiff / (1000 * 60 * 60 * 24)) + 1);

                    dateInfo = `
                        <div class="summary-item">
                            <span>Start Date:</span>
                            <span>${formatDateWithTime(startDate, true)}</span>
                        </div>
                        <div class="summary-item">
                            <span>End Date:</span>
                            <span>${formatDateWithTime(nextDay, false)}</span>
                        </div>
                        <div class="summary-item">
                            <span>Number of Days:</span>
                            <span>${dayCount}</span>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Date parsing error:', error, selectedDates);
                return;
            }
        }

        // Guest surcharge calculation (6% per additional guest on room total only)
        const totalGuests = parseInt(document.getElementById('totalGuests').value) || 1;
        const additionalGuests = totalGuests - 1;
        const guestSurcharge = roomTotal * 0.06 * additionalGuests;

        // Add-on services (not subject to guest surcharge)
        let addonTotal = 0;
        const pickupCheckbox = document.getElementById('pickup');
        if (pickupCheckbox && pickupCheckbox.checked) {
            addonTotal += parseFloat(pickupCheckbox.value);
        }

        const subtotalBeforeDiscount = roomTotal + guestSurcharge + addonTotal;

        // Calculate multi-room discount
        const selectedRoomsCount = selectedRooms.length;
        const multiRoomDiscount = calculateMultiRoomDiscount(selectedRoomsCount, subtotalBeforeDiscount);
        const subtotal = subtotalBeforeDiscount - multiRoomDiscount;

        // Calculate promo discount
        const promoDiscount = subtotal * activePromoDiscount;
        const finalTotal = subtotal - promoDiscount;

        // Use finalTotal for booking fee and balance
        const bookingFee = finalTotal * 0.5;
        const balance = finalTotal - bookingFee;

        // Build the summary HTML
        let summaryHTML = `
            ${selectedRoomsDisplay ? `<div class="summary-item"><span>Room Selection:</span><span>${selectedRoomsDisplay}</span></div>` : ''}
            ${dateInfo}
            <div class="summary-item">
                <span>Number of Guests:</span>
                <span>${totalGuests}</span>
            </div>
            <div class="summary-item">
                <span>Room Total:</span>
                <span>$${roomTotal.toFixed(2)}</span>
            </div>
            ${additionalGuests > 0 ? `<div class="summary-item"><span>Guest Surcharge (${additionalGuests} × 6%):</span><span>$${guestSurcharge.toFixed(2)}</span></div>` : ''}
            ${addonTotal > 0 ? `<div class="summary-item"><span>Add-on Services:</span><span>$${addonTotal.toFixed(2)}</span></div>` : ''}
            <hr style="border: 1px solid rgba(255,255,255,0.2); margin: 15px 0;">
            <div class="summary-item">
                <span><strong>Subtotal:</strong></span>
                <span><strong>$${subtotalBeforeDiscount.toFixed(2)}</strong></span>
            </div>
        `;

        // Add multi-room discount if applicable
        if (multiRoomDiscount > 0) {
            const discountPercentage = selectedRoomsCount === 2 ? '10%' : '20%';
            summaryHTML += `
                <div class="summary-item" style="color: var(--accent-color);">
                    <span>Multi-Room Discount (${discountPercentage}):</span>
                    <span>-$${multiRoomDiscount.toFixed(2)}</span>
                </div>
            `;
        }

        if (activePromoDiscount > 0) {
            summaryHTML += `
                <div class="summary-item" style="color: var(--accent-color);">
                    <span>Promo Discount (${(activePromoDiscount * 100).toFixed(0)}%):</span>
                    <span>-$${promoDiscount.toFixed(2)}</span>
                </div>
            `;
        }

        summaryHTML += `
            <hr>
            <div class="summary-item">
                <span><strong>Total Payable at Booking (50%):</strong></span>
                <span><strong>$${bookingFee.toFixed(2)}</strong></span>
            </div>
            <div class="summary-item">
                <span>Balance Payable Before Check-in:</span>
                <span>$${balance.toFixed(2)}</span>
            </div>
        `;

        summary.innerHTML = summaryHTML;
    }

    // Promo code functionality
    function applyPromoCode() {
        const promoCode = document.getElementById('promoCode').value.trim().toLowerCase();
        const promoMessage = document.getElementById('promoMessage');

        // Sample promo codes - replace with your actual logic
        const validPromoCodes = {
            'welcome10': 0.10,
            'summer15': 0.15,
            'early20': 0.20
        };

        if (validPromoCodes[promoCode]) {
            activePromoDiscount = validPromoCodes[promoCode]; // <-- Set the global discount
            promoMessage.textContent = `Promo code applied! ${(activePromoDiscount * 100)}% discount`;
            promoMessage.style.color = 'green';
            updatePriceSummary();
        } else if (promoCode) {
            activePromoDiscount = 0; // <-- Reset if invalid
            promoMessage.textContent = 'Invalid promo code';
            promoMessage.style.color = 'red';
            updatePriceSummary();
        } else {
            activePromoDiscount = 0; // <-- Reset if empty
            promoMessage.textContent = 'Please enter a promo code';
            promoMessage.style.color = 'orange';
        }
        updatePriceSummary();
    }

    // Enhanced form submission with new date format in confirmation
    document.getElementById('bookingRequestForm').addEventListener('submit', async function(e) {
        e.preventDefault();

            // ── FIX: make sure these values exist in this scope ──
        const totalGuests   = parseInt(document.getElementById('totalGuests').value, 10) || 1;
        const selectedDates = JSON.parse(sessionStorage.getItem('selectedDates') || '{}');
        const form = e.target;
        const formData = new FormData(form);

        // Generate unique 4-digit ID
        const uniqueId = Math.floor(1000 + Math.random() * 9000);
        formData.append('uniqueId', uniqueId);

        // Gather selected rooms (as values: room1, room2, room3)
        const selectedRooms = Array.from(document.querySelectorAll('input[type="checkbox"][name="rooms"]:checked'))
            .map(cb => cb.value);
        const firstNameField = document.getElementById('firstName');
        const lastNameField = document.getElementById('lastName');
        const primaryGuestName = `${firstNameField.value.trim()} ${lastNameField.value.trim()}`.trim();

        formData.append('selectedRooms', JSON.stringify(selectedRooms));

        // Gather room days and start dates
        selectedRooms.forEach(room => {
            const days = document.getElementById(`${room}Days`).value;
            const startDate = document.getElementById(`${room}StartDate`).value;
            formData.append(`${room}Days`, days);
            formData.append(`${room}StartDate`, startDate);
        });

        // Gather dynamic guest details (if any)
        const guestDetailsInputs = document.querySelectorAll('#guestDetails input, #guestDetails select');
        guestDetailsInputs.forEach(input => {
            formData.append(input.name, input.value);
        });

        // Calculate totals for full breakdown with multi-room discount
        const roomPrices = { room1: 129, room2: 99, room3: 169 };
        let roomTotal = 0;
        let numDays = 0;

        document.querySelectorAll('#bookingForm input[type="checkbox"][name="rooms"]:checked').forEach(room => {
            const roomId = room.id;
            const days = parseInt(document.getElementById(`${roomId}Days`).value) || 1;
            roomTotal += roomPrices[roomId] * days;
            numDays = Math.max(numDays, days);
        });

        const additionalGuests = parseInt(totalGuests) - 1;
        const guestSurcharge = roomTotal * 0.06 * additionalGuests;
        const addonTotal = document.getElementById('pickup').checked ? 20 : 0;
        const subtotalBeforeDiscount = roomTotal + guestSurcharge + addonTotal;

        // Calculate multi-room discount for confirmation
        const selectedRoomsCount = selectedRooms.length;
        const multiRoomDiscount = calculateMultiRoomDiscount(selectedRoomsCount, subtotalBeforeDiscount);
        const subtotal = subtotalBeforeDiscount - multiRoomDiscount;
        const promoDiscount = subtotal * activePromoDiscount;
        const finalTotal = subtotal - promoDiscount;
        const bookingFee = finalTotal * 0.5;
        const balance = finalTotal - bookingFee;

        formData.append('roomTotal', roomTotal);
        formData.append('numDays', numDays);
        formData.append('additionalGuests', additionalGuests);
        formData.append('guestSurcharge', guestSurcharge);
        formData.append('addonTotal', addonTotal);
        formData.append('subtotalBeforeDiscount', subtotalBeforeDiscount);
        formData.append('multiRoomDiscount', multiRoomDiscount);
        formData.append('promoDiscount',  promoDiscount);
        formData.append('subtotal', subtotal);


        // Format dates for confirmation with new (PM)/(AM) format
        let dateRangeDisplay = '';
        if (selectedDates.start && selectedDates.end) {
            const startDate = new Date(selectedDates.start);
            const endDate = new Date(selectedDates.end);

            if (selectedDates.start === selectedDates.end) {
                // Single day
                const nextDay = new Date(startDate);
                nextDay.setDate(nextDay.getDate() + 1);
                dateRangeDisplay = `${formatDateLongWithTime(startDate, true)} - ${formatDateLongWithTime(nextDay, false)}`;
            } else {
                // Multi-day
                const nextDay = new Date(endDate);
                nextDay.setDate(nextDay.getDate() + 1);
                dateRangeDisplay = `${formatDateLongWithTime(startDate, true)} - ${formatDateLongWithTime(nextDay, false)}`;
            }
        }

        // Show enhanced popup
        document.getElementById('uniqueId').textContent = uniqueId;

        document.getElementById('bookingSummary').innerHTML = `
            <div style="text-align: left; margin-bottom: 15px;">
                <strong>Primary Guest:</strong> ${primaryGuestName}<br>
                <strong>Selected Rooms:</strong> ${selectedRooms.join(', ')}<br>
                <strong>Dates:</strong> ${dateRangeDisplay}<br>
                <strong>Total Guests:</strong> ${totalGuests}<br>
                <strong>Number of Days:</strong> ${numDays}
            </div>
        `;

        // ───────────────── Price-breakdown (confirmation card) ─────────────────
        let priceBreakdownHTML = `
            <div style="text-align: left; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                <h4 style="margin-top: 0; color: var(--accent-color);">Price Breakdown:</h4>

                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Room Total:</span>
                    <span>$${roomTotal.toFixed(2)}</span>
                </div>

                ${additionalGuests > 0 ? `
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Guest Surcharge (${additionalGuests} × 6%):</span>
                    <span>$${guestSurcharge.toFixed(2)}</span>
                </div>
                ` : ''}

                ${addonTotal > 0 ? `
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Add-on Services:</span>
                    <span>$${addonTotal.toFixed(2)}</span>
                </div>
                ` : ''}

                <hr style="border: 1px solid rgba(255,255,255,0.2); margin: 10px 0;">

                <div style="display: flex; justify-content: space-between; margin: 5px 0; font-weight: bold;">
                    <span>Subtotal:</span>
                    <span>$${subtotalBeforeDiscount.toFixed(2)}</span>
                </div>
        `;

        // ─── Multi-room discount (if any) ───────────────────────
        if (multiRoomDiscount > 0) {
            const discountPercentage = selectedRoomsCount === 2 ? '10%' : '20%';
            priceBreakdownHTML += `
                <div style="display: flex; justify-content: space-between; margin: 5px 0; color: var(--accent-color);">
                    <span>Multi-Room Discount (${discountPercentage}):</span>
                    <span>-$${multiRoomDiscount.toFixed(2)}</span>
                </div>
            `;
        }

        // ─── Promo discount (NEW) ───────────────────────────────
        if (promoDiscount > 0) {
            priceBreakdownHTML += `
                <div style="display: flex; justify-content: space-between; margin: 5px 0; color: var(--accent-color);">
                    <span>Promo Discount (${(activePromoDiscount * 100).toFixed(0)}%):</span>
                    <span>-$${promoDiscount.toFixed(2)}</span>
                </div>
            `;
        }

        priceBreakdownHTML += `
                <hr style="border: 1px solid rgba(255,255,255,0.2); margin: 10px 0;">

                <div style="display: flex; justify-content: space-between; margin: 5px 0; font-weight: bold; color: var(--accent-color);">
                    <span>Payable at Booking (50%):</span>
                    <span>$${bookingFee.toFixed(2)}</span>          <!-- was subtotal*0.5 -->
                </div>

                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Balance Due Before Check-in:</span>
                    <span>$${balance.toFixed(2)}</span>             <!-- was subtotal*0.5 -->
                </div>
            </div>
        `;

        document.getElementById('fullPriceBreakdown').innerHTML = priceBreakdownHTML;

        document.getElementById('fullPriceBreakdown').innerHTML = priceBreakdownHTML;

        document.getElementById('thankYouPopup').style.display = 'flex';

        // Reset promo code state for next booking
        activePromoDiscount = 0;
        document.getElementById('promoCode').value = '';
        document.getElementById('promoMessage').textContent = '';
        updatePriceSummary();

        // Here you would send the actual booking request to your backend and emails
        console.log('Booking request submitted with ID:', uniqueId);

        // Simulate sending emails
        console.log('Sending confirmation email to:', document.getElementById('email').value);
        console.log('Sending notification to admin and CC to manager@murneyhouse.ca');
    });

    function returnToHome() {
        window.location.href = '../index.html';
    }

    // Character counter for special requests
    document.getElementById('specialRequests').addEventListener('input', function() {
        const count = this.value.length;
        document.getElementById('charCount').textContent = `${count}/500 characters`;
    });

    // Initialize on load
    window.addEventListener('load', function() {
        setBookingHeroBackground();
    });

    window.addEventListener('resize', setBookingHeroBackground);

    // Enhanced event listeners for real-time updates
    document.addEventListener('DOMContentLoaded', function() {
        // Listen for room checkbox changes
        document.querySelectorAll('#bookingForm input[type="checkbox"][name="rooms"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                synchronizeRoomDays();
            });
        });

        // Listen for days input changes with synchronization
        document.querySelectorAll('#bookingForm input[type="number"][id$="Days"]').forEach(input => {
            input.addEventListener('input', function() {
                synchronizeRoomDays();
            });

            input.addEventListener('change', function() {
                synchronizeRoomDays();
            });
        });

        // Listen for total guests changes
        const totalGuestsInput = document.getElementById('totalGuests');
        if (totalGuestsInput) {
            totalGuestsInput.addEventListener('input', function() {
                updatePriceSummary();
            });

            totalGuestsInput.addEventListener('change', function() {
                updatePriceSummary();
            });
        }

        // Listen for pickup checkbox changes
        const pickupCheckbox = document.getElementById('pickup');
        if (pickupCheckbox) {
            pickupCheckbox.addEventListener('change', function() {
                updatePriceSummary();
            });
        }
    });
    </script>
    <script src="../shared/contact-modal.js"></script>
</body>
</html>
